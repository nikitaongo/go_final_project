# Планировщик задач

## Описание проекта.

**Планировщик задач** – это веб-приложение для планирования и отслеживания задач:
- Поддерживается создание задач с различными шаблонами повторения (ежедневно, еженедельно и так далее). 
- Пользователь может полностью управлять задачами через **веб-интерфейс**: добавлять, удалять, редактировать задачу и изменять интервал её повторения.
- Реализована базовая **аутентификация по паролю**. 


## Список выполненных заданий "со звёздочкой":

1. Реализована возможность определять извне порт при запуске сервера через переменную окружения `TODO_PORT`.
2. Реализована возможность определять путь к файлу базы данных через переменную окружения `TODO_DBFILE`.
3. Реализована возможность работы с интервалами `weekly` (задача назначается в указанные дни недели)
4. Реализована возможность работы с интервалами `monthly` (задача назначается в указанные дни месяца, дополнительно - в определённые месяцы, если необходимо)
5. Реализован поиск задач с учётом регистра, а также по дате. Дата должна быть указана в формате `ДД.ММ.ГГГГ`.
6. Реализована базовая аутентификация по паролю. Пароль задаётся через переменную окружения `TODO_PASSWORD`.


## Инструкция по запуску Палнировщика локально:
Проект реализован на Go 1.25. Совместимость с версиями Go начиная с 1.22 и выше не тестировалась, но ожидается без изменений. 
### Для запуска исходного кода локально:
1. Скопируйте репозиторий:
```bash
git clone https://github.com/nikitaongo/go_final_project
```

2. Перейдите в папку с исходным кодом:
```bash
cd go_final_project
```

3. Обновите зависимости:
```bash
go mod tidy
```

4. Запустите приложение:
```bash
go run .
```

5. Сервер выведет в консоль адрес с номером порта на котором он запущен, а также сообщит, задан ли пароль:
```bash
Todo server started on http://localhost:7540
No authorization with password required.
```

6. Перейдите в браузере по ссылке: `http://localhost:7540`. Для остановки сервера используйте сочетание клавиш `Ctrl+C` в консоли.
## Локальные переменные
Все локальные переменные не обязательны, и если они не заданы, будут использоваться стандартные значения, а именно:
 - порт: `7540`
 - путь к файлу базы данных: `./scheduler.db`
 - пароль - не задан.
 При запуске сервер выведет в консоль адрес с номером порта на котором он запущен:
 ```bash
 Todo server started on http://localhost:7540
 ```
 а также сообщит, задан ли пароль:
 ```bash
 No authorization with password required.
 ```
 
 Таким образом, если выполнить команду:
```bash
export TODO_PASSWORD="12345"
```
будет задан пароль для доступа к Планировщику, а также сервер предупредит о том что потребуется авторизация:
 ```bash
 Authorization with password required.
 ```

Аналогичной командой могут быть заданы локальные переменные `TODO_PORT` и `TODO_DBFILE`. Для вывода текущего значения локальной переменной используется команада `echo` с указанием переменной, например:
```bash
echo $TODO_PORT
```

Для остановки сервера используйте сочетание клавиш **`Ctrl+C`** в консоли.
## Инструкция по запуску тестов.
### Настройки тестов
Перед тестированием необходимо убедиться, что настройки тестов в файле `tests/settings.go` соответствуют локальным переменным. Для тестирования уже указаны настройки:
```go
package tests

var Port = 7540
var DBFile = "../scheduler.db"
var FullNextDate = true
var Search = true
var Token = `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.e30.6_MY18OpjrylElg8crkSFAJCIXJmy05XDKvGO8KZ_aI`
```
Флаги:
- `FullNextDate` позволяет подключать полное тестирование модуля расчёта следующей даты напоминания.
- `Search` позволяет выполнить тестирование поиска напомнинаний.
- `Token` - JWT токен для аутентификации, соответствует паролю `12345`**\***
Остальные настройки соответствуют следующим параметрам переменных:
```txt
TODO_PASSWORD="12345"
TODO_PORT="7540"
TODO_DBFILE="scheduler.db"
```

\***Обратите внимание**: в настройках тестов указан токен, который соответствует паролю `12345`, тесты пройдут успешно, если задан пароль:
```txt
TODO_PASSWORD="12345"
```
..или логика программы не выполняет аутентификацию при:
```txt
TODO_PASSWORD=""
```

Чтобы запустить тесты `go test ./tests` для веб-сервера с включённой аутентификацией и другим паролем - присвойте переменной `Token` в `tests/settings.go` значение токена, которое сервер возвратил из `/api/signin` и которое хранится в куке `token`.
### Запуск тестов
Таким образом, чтобы протестировать все модули с учетом аутентификации и расширенного дополнительными задачами функционала, нужно:
1. Запустить сервер из корневой папки проекта командой:
```bash
go run .
```
2. Открыть второе окно терминала и выполнить из корневой папки проекта:
```bash
go test ./tests
```

Рекомендуется выполнять очистку кэша перед повторными запусками тестов:
```bash
go clean -testcache
```


### Запуск тестов по отдельности для каждого модуля.
Команды для запуска отдельных тестов представлены ниже:
```bash
# Тест сервера:
go test -run ^TestApp$ ./tests

# Тест базы данных:
go test -run ^TestDB$ ./tests

# Тест модуля расчёта следующей даты напоминания:
go test -run ^TestNextDate$ ./tests

# Тест модуля для добавления задачи:
go test -run ^TestAddTask$ ./tests

# Тест модуля для отображения задач:
go test -run ^TestTasks$ ./tests

# Тест модуля для отметки задачи выполненной:
go test -run ^TestDone$ ./tests

# Тест модуля для удаления задачи:
go test -run ^TestDelTask$ ./tests

```

Рекомендуется выполнять очистку кэша перед повторными запусками тестов:
```bash
go clean -testcache
```
## Инструкция по сборке и запуску образа через докер.
В корне проекта присутствует Dockerfile для мультистейдж сборки образа. Чтобы собрать контейнер и запустить его потребуется выполнить несколько шагов:
1. Собрать контейнер :
```bash
docker build -t go-final .
```

2. Запустить контейнер:
   - с любыми параметрами:
```bash
docker run --rm \
-e TODO_PASSWORD=yourpassword \
-e TODO_PORT=9876 \
-e TODO_DBFILE=yourdbname.db \
-p 9876:9876 \
go-final
```
   - со стандартными параметрами:
```bash
docker run --rm -p 7540:7540 go-final
```

3. Перейти в браузере по ссылке: `http://localhost:7540`(или на другой порт, если он был изменён)

- Сборка образа происходит под архитектуру хоста.
- Стандартные значения локальных переменных указаны явно в dockerfile, но могут быть изменены при запуске контейнера.
- База данных не копируется при создании образа, а файлы  `*.db` добавлены в исключения `.dockerignore`